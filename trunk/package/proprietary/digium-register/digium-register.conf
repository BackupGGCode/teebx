# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../digium-register/digium-register.conf
# Copyright (C) 2011 The AskoziaPBX Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---


# set to the name of the source archive name and the directory it extracts to
sourcefile="registersource.tgz"
extracteddir="registersource"

# add any make options needed here
var_append makeopt " " "SOMEVARIABLEHERE=myvalue"
# add any additional gcc options needed here
var_append GCC_WRAPPER_APPEND ' ' "-I$root/usr/include"

# shorten some paths up...
pkgdir="$base/package/proprietary/digium-register"


register_main() {
	echo "Starting register_main() ... "

	if [ ! -d $pkgdir/targets/$target ]; then
		echo "  - never seen this target before, making a home for it..."
		mkdir $pkgdir/targets/$target
	else
		echo "  - familiar target, continuing..."
	fi

	if [ -f $pkgdir/$sourcefile ]; then
		echo "  - found source, time to compile..."
		if [ ! -d $pkgdir/targets/$target/$ver ]; then
			echo "  - new target + version combo, making a home for it..."
			mkdir $pkgdir/targets/$target/$ver
		else
			echo "  - familiar target + version combo exists, cleaning..."
			rm $pkgdir/targets/$target/$ver/register
		fi
		echo "  - creating a build directory..."
		mkdir $pkg-$ver
		cd $pkg-$ver
		echo "  - copying and extracting source..."
		cp $pkgdir/$sourcefile .
		tar zxf $sourcefile
		cd $extracteddir
		echo "  - making... ($MAKE $makeopt)"
		eval $MAKE $makeopt
		echo "  - copying register util binary into target/version directory for storage..."
		cp register $pkgdir/targets/$target/$ver/
	else
		echo "  - no source found, not compiling..."
	fi

	if [ -f $pkgdir/targets/$target/$ver/register ]; then
		echo "  - binary register util found for target, copying into firmware build..."
		cp $pkgdir/targets/$target/$ver/register $root/usr/sbin
	else
		echo "  - no binary register util found for target, nothing copied into firmware build..."
	fi
}

mainfunction="register_main"
